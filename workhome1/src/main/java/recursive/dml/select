--Find the upward recommendation chain for member ID 27
 >> with recursive recommenders(recommender) as (
    select recommendedby from cd.members where memid = 27
    union all
    select mems.recommendedby
    from recommenders recs
    inner join cd.members mems
    on mems.memid = recs.recommender)
    select recs.recommender, mems.firstname, mems.surname
    from recommenders recs
    inner join cd.members mems
    on recs.recommender = mems.memid
    order by memid desc

--Find the downward recommendation chain for member ID 1
 >> with recursive recommender1(memid,firstname,sername) as (
    select m1.memid  ,m1.firstname ,m1.surname from cd.members m1
    where recommendedby = 1
    union
    select m2.memid, m2.firstname ,m2.surname from cd.members m2
    join recommender1 r1 on r1.memid = m2.recommendedby)
    select * from recommender1
    order by memid

--Produce a CTE that can return the upward recommendation chain for any member
 >> with recursive recommenders(recommender, member) as (
    select recommendedby, memid
    from cd.members
    union all
    select mems.recommendedby, recs.member
    from recommenders recs
    inner join cd.members mems
    on mems.memid = recs.recommender)
    select recs.member member, recs.recommender, mems.firstname, mems.surname
    from recommenders recs
    inner join cd.members mems
    on recs.recommender = mems.memid
    where recs.member = 22 or recs.member = 12
    order by recs.member asc, recs.recommender desc